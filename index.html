<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cor-Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS personnalisé pour le thème */
        :root {
            --primary-color: #2563eb; /* Couleur par défaut (Bleu) */
        }
        .text-primary { color: var(--primary-color); }
        .bg-primary { background-color: var(--primary-color); }
        .border-primary { border-color: var(--primary-color); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img id="logoSite" src="" alt="Logo" class="h-10 w-10 hidden rounded-full">
                <h1 id="orgName" class="text-2xl font-bold text-gray-900">Cor-Tech</h1>
            </div>
            <nav>
                </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-1 space-y-6">

            <div id="eventsContainer" class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-primary">
                <h2 class="text-xl font-extrabold text-gray-800 mb-4 flex items-center"><i class="fas fa-calendar-alt text-primary mr-3"></i> Évènements à venir</h2>
                <div id="eventsList" class="space-y-4">
                    <p id="noEvents" class="text-gray-500 italic hidden">Aucun événement planifié pour le moment.</p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-extrabold text-gray-800 mb-4 flex items-center"><i class="fas fa-clock text-orange-500 mr-3"></i> Horaires</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-bold text-gray-700 mb-1">Période Scolaire :</h3>
                        <pre id="hoursSchool" class="text-gray-600 whitespace-pre-wrap"></pre>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-700 mb-1">Vacances :</h3>
                        <pre id="hoursHolidays" class="text-gray-600 whitespace-pre-wrap"></pre>
                    </div>
                </div>
            </div>

            <div id="socialContainer" class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-extrabold text-gray-800 mb-4 flex items-center"><i class="fas fa-share-alt text-teal-500 mr-3"></i> Nous suivre</h2>
                <div id="socialLinks" class="flex justify-around items-center text-3xl">
                    </div>
            </div>

        </div>

        <div class="lg:col-span-2">
            <h2 class="text-2xl font-extrabold text-gray-800 mb-4 flex items-center"><i class="fas fa-bullhorn text-red-500 mr-3"></i> Dernières Actualités</h2>
            <div id="newsList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div id="loadingNews" class="md:col-span-2 text-center text-gray-500">Chargement...</div>
            </div>
        </div>

    </main>

    <footer class="bg-gray-800 text-white p-6 mt-12">
        <div class="max-w-7xl mx-auto text-center">
            <p>&copy; <span id="currentYear"></span> <span id="footerOrgName">Cor-Tech</span>. Tous droits réservés.</p>
            <p class="text-sm mt-2">Pour toute question, <a href="#" onclick="alert('Veuillez intégrer votre formulaire de contact ici.')" class="underline hover:text-primary">contactez-nous</a>.</p>
        </div>
    </footer>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        const THEME_COLOR = '#2563eb'; // Default color

        function setThemColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
        }
        
        // 1. Fonction pour charger les données
        async function loadData() {
            try {
                // Important: Ajouter un paramètre de cache-busting pour forcer le rechargement
                const res = await fetch('data.json?t=' + Date.now());
                if (!res.ok) throw new Error('Erreur de chargement du fichier data.json');
                const data = await res.json();
                
                // 2. Traitement des Settings
                const settings = data.settings || {};
                document.getElementById('orgName').textContent = settings.orgName || 'Cor-Tech';
                document.getElementById('footerOrgName').textContent = settings.orgName || 'Cor-Tech';
                if (settings.themeColor) setThemColor(settings.themeColor); else setThemColor(THEME_COLOR);

                if(settings.logoUrl) {
                    const logo = document.getElementById('logoSite');
                    logo.src = settings.logoUrl;
                    logo.classList.remove('hidden');
                }

                document.getElementById('hoursSchool').textContent = settings.hours?.school || 'Non défini';
                document.getElementById('hoursHolidays').textContent = settings.hours?.holidays || 'Non défini';
                
                renderSocialLinks(settings.social);

                // 3. Rendu des Événements (Colonne de Gauche)
                renderEvents(data.events);

                // 4. Rendu des Actualités (Colonne de Droite / Grille)
                renderNews(data.news);

                document.getElementById('loadingNews').remove();

            } catch (error) {
                console.error("Erreur critique:", error);
                document.getElementById('newsList').innerHTML = '<p class="text-red-500 md:col-span-2">Impossible de charger les données du site. Veuillez contacter l\'administrateur.</p>';
            }
        }

        // 5. Fonction pour générer le HTML des Événements
        function renderEvents(events) {
            const list = document.getElementById('eventsList');
            list.innerHTML = '';
            
            // Triez par date: le plus proche en premier
            const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));

            if (sortedEvents.length === 0) {
                document.getElementById('noEvents').classList.remove('hidden');
                return;
            }

            sortedEvents.forEach(evt => {
                const eventDate = new Date(evt.date);
                const options = { weekday: 'short', day: 'numeric', month: 'short' };
                const formattedDate = eventDate.toLocaleDateString('fr-FR', options);

                const html = `
                    <div class="flex bg-gray-50 p-3 rounded-lg border border-gray-200 hover:shadow-lg transition">
                        <div class="flex-shrink-0 w-16 h-16 mr-3 rounded-md overflow-hidden border border-gray-300">
                            ${evt.image ? `<img src="${evt.image}" alt="${evt.title}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center bg-gray-200 text-gray-500 text-xs text-center p-1"><i class="fas fa-image"></i></div>`}
                        </div>
                        <div class="flex-grow">
                            <h3 class="font-bold text-gray-800">${evt.title}</h3>
                            <p class="text-sm text-primary font-semibold"><i class="fas fa-calendar-day mr-1"></i> ${formattedDate}</p>
                            <p class="text-sm text-gray-500 truncate">${evt.description}</p>
                            <a href="#" onclick="alert('Lien d\'inscription pour : ${evt.title}')" class="text-xs font-semibold text-primary hover:text-blue-700">S'inscrire <i class="fas fa-arrow-right ml-1"></i></a>
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }
        
        // 6. Fonction pour générer le HTML des News
        function renderNews(news) {
            const list = document.getElementById('newsList');
            list.innerHTML = '';
            
            // Triez par date : le plus récent en premier
            const sortedNews = news.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedNews.length === 0) {
                list.innerHTML = '<p class="text-gray-500 md:col-span-2 italic">Aucune actualité récente à afficher.</p>';
                return;
            }

            sortedNews.forEach(n => {
                const tagClasses = {
                    'info': 'bg-blue-100 text-blue-800',
                    'urgent': 'bg-red-100 text-red-800',
                    'event': 'bg-green-100 text-green-800'
                };
                const tagText = {
                    'info': 'Information',
                    'urgent': 'URGENT',
                    'event': 'Vie Asso'
                };
                const tagClass = tagClasses[n.tag] || 'bg-gray-100 text-gray-800';
                const date = new Date(n.date).toLocaleDateString('fr-FR');

                const html = `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col h-full hover:shadow-xl transition duration-300">
                        ${n.image ? `<img src="${n.image}" alt="${n.title}" class="w-full h-48 object-cover">` : `<div class="w-full h-48 flex items-center justify-center bg-gray-200 text-gray-500 text-lg"><i class="fas fa-info-circle"></i> Pas d'image</div>`}
                        <div class="p-5 flex flex-col flex-grow">
                            <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${tagClass} self-start mb-2">${tagText[n.tag]}</span>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">${n.title}</h3>
                            <p class="text-sm text-gray-600 mb-3 flex-grow">${n.content}</p>
                            <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                                <span class="text-xs text-gray-500"><i class="fas fa-clock mr-1"></i> ${date}</span>
                                <a href="#" onclick="alert('Détails : ${n.title}')" class="text-sm font-semibold text-primary hover:text-blue-700">Lire la suite</a>
                            </div>
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }
        
        // 7. Fonction pour générer les icônes Social
        function renderSocialLinks(social) {
            const linksContainer = document.getElementById('socialLinks');
            linksContainer.innerHTML = '';

            const socialIcons = [
                { key: 'facebook', icon: 'fab fa-facebook-square', color: 'text-blue-600' },
                { key: 'instagram', icon: 'fab fa-instagram', color: 'text-pink-600' },
                { key: 'tiktok', icon: 'fab fa-tiktok', color: 'text-black' },
                { key: 'youtube', icon: 'fab fa-youtube', color: 'text-red-600' }
            ];

            socialIcons.forEach(item => {
                const url = social?.[item.key];
                if (url) {
                    const html = `
                        <a href="${url}" target="_blank" class="${item.color} hover:opacity-75 transition" aria-label="${item.key}">
                            <i class="${item.icon}"></i>
                        </a>
                    `;
                    linksContainer.innerHTML += html;
                }
            });
            
            if (linksContainer.innerHTML === '') {
                document.getElementById('socialContainer').classList.add('hidden');
            } else {
                 document.getElementById('socialContainer').classList.remove('hidden');
            }
        }

        // Lancement au chargement de la page
        loadData();
    </script>
</body>
</html>
