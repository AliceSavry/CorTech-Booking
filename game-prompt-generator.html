<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√©n√©rateur de Prompts Jeux - COR-TECH</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --c-neon: #a78bfa;
      --c-violet: #7c3aed;
      --c-violet-dark: #1e1033;
      --c-violet-darker: #0f0a1a;
      --c-violet-light: #c4b5fd;
      --c-text: #e5e7eb;
      --c-bg: #050508;
      --c-panel: #0a0a12;
      --c-border: #2e1f4d;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--c-bg);
      font-family: 'Rajdhani', sans-serif;
      color: var(--c-text);
      min-height: 100vh;
    }

    h1, h2, h3 { font-family: 'Orbitron', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
    .font-tech { font-family: 'Share Tech Mono', monospace; }

    /* Header */
    .generator-header {
      background: linear-gradient(135deg, #0f0a1a 0%, #1a1033 100%);
      padding: 30px 24px;
      border-bottom: 3px solid var(--c-neon);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .generator-header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(167, 139, 250, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(0, 255, 255, 0.05) 0%, transparent 50%);
      pointer-events: none;
    }
    .generator-header h1 {
      color: var(--c-neon);
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      text-shadow: 0 0 20px rgba(167, 139, 250, 0.5);
      position: relative;
      z-index: 1;
    }
    .generator-header h1 i { 
      color: var(--c-violet-light);
      animation: bubble 2s ease-in-out infinite;
    }
    @keyframes bubble {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(5deg); }
    }
    .generator-header p {
      color: var(--c-violet-light);
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.9rem;
      margin-top: 10px;
      opacity: 0.8;
      position: relative;
      z-index: 1;
    }
    .generator-header .subtitle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(167, 139, 250, 0.1);
      border: 1px solid var(--c-violet-dark);
      padding: 8px 16px;
      border-radius: 20px;
      margin-top: 15px;
      position: relative;
      z-index: 1;
    }
    .header-badge {
      background: rgba(167, 139, 250, 0.1);
      border: 1px solid var(--c-border);
      color: var(--c-violet-light);
      padding: 6px 12px;
      border-radius: 4px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
    }

    /* Layout */
    .generator-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      min-height: calc(100vh - 70px);
    }

    /* Panneaux */
    .form-panel {
      background: var(--c-panel);
      padding: 24px;
      overflow-y: auto;
      border-right: 1px solid var(--c-border);
    }
    .preview-panel {
      background: var(--c-bg);
      display: flex;
      flex-direction: column;
    }

    /* Sections */
    .section-title {
      color: var(--c-neon);
      font-size: 0.85rem;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--c-border);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-title i { color: var(--c-violet); }

    /* Form groups */
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      color: var(--c-violet-light);
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    /* Selects */
    select {
      width: 100%;
      padding: 12px 15px;
      background: var(--c-violet-darker);
      border: 1px solid var(--c-border);
      border-radius: 6px;
      color: white;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    select:focus {
      outline: none;
      border-color: var(--c-neon);
      box-shadow: 0 0 15px rgba(167, 139, 250, 0.2);
    }
    select option {
      background: var(--c-panel);
      color: white;
      padding: 10px;
    }

    /* Checkboxes */
    .checkbox-group {
      background: var(--c-violet-darker);
      border: 1px solid var(--c-border);
      border-radius: 6px;
      padding: 15px;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    .checkbox-item:hover { color: var(--c-neon); }
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--c-violet);
      cursor: pointer;
    }
    .checkbox-item span {
      font-size: 0.9rem;
    }
    .checkbox-item.troll-mode {
      margin-top: 10px;
      padding-top: 15px;
      border-top: 1px dashed var(--c-border);
    }
    .checkbox-item.troll-mode span {
      color: #ff6b6b;
      font-weight: bold;
    }
    .checkbox-item.troll-mode input:checked {
      accent-color: #ff6b6b;
    }
    .troll-description {
      font-size: 0.7rem;
      color: #666;
      margin-left: 30px;
      margin-top: 4px;
    }

    /* Range slider */
    .range-container {
      background: var(--c-violet-darker);
      border: 1px solid var(--c-border);
      border-radius: 6px;
      padding: 15px;
    }
    .range-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #666;
      margin-top: 8px;
    }
    input[type="range"] {
      width: 100%;
      height: 6px;
      background: var(--c-border);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--c-neon);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px var(--c-neon);
    }

    /* Buttons */
    .btn-primary {
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(135deg, var(--c-violet-dark), var(--c-violet));
      border: 1px solid var(--c-neon);
      border-radius: 6px;
      color: white;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, var(--c-violet), var(--c-violet-dark));
      box-shadow: 0 0 25px rgba(167, 139, 250, 0.4);
      transform: translateY(-2px);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      padding: 10px 16px;
      background: transparent;
      border: 1px solid var(--c-border);
      border-radius: 4px;
      color: var(--c-violet-light);
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-secondary:hover {
      border-color: var(--c-neon);
      color: var(--c-neon);
      background: rgba(167, 139, 250, 0.05);
    }
    .btn-secondary:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .buttons-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .buttons-row .btn-secondary { flex: 1; justify-content: center; }

    /* Preview area */
    .preview-header {
      padding: 15px 20px;
      background: var(--c-panel);
      border-bottom: 1px solid var(--c-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .preview-header h2 {
      color: #888;
      font-size: 0.8rem;
    }
    .preview-meta {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--c-violet-light);
    }

    .preview-frame-container {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .preview-frame-wrapper {
      flex: 1;
      background: var(--c-panel);
      border: 1px solid var(--c-border);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      min-height: 300px;
    }
    .preview-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #444;
    }
    .preview-placeholder i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--c-violet-dark);
    }
    .preview-placeholder p {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.9rem;
    }
    .preview-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: black;
      border-radius: 8px;
    }
    .troll-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4444;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      font-weight: bold;
      transform: rotate(3deg);
      box-shadow: 0 2px 10px rgba(255, 68, 68, 0.5);
    }

    .preview-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .preview-controls button { flex: 1; }

    /* Output section */
    .output-section {
      background: var(--c-panel);
      border-top: 1px solid var(--c-border);
      padding: 20px;
    }
    .output-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .output-tab {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--c-border);
      border-radius: 4px;
      color: #666;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .output-tab:hover {
      border-color: var(--c-violet);
      color: var(--c-violet-light);
    }
    .output-tab.active {
      background: var(--c-violet-dark);
      border-color: var(--c-neon);
      color: var(--c-neon);
    }

    .output-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .output-code {
      background: #000;
      border: 1px solid var(--c-border);
      border-radius: 6px;
      padding: 15px;
      max-height: 250px;
      overflow: auto;
    }
    .output-code pre {
      margin: 0;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: #4ade80;
      white-space: pre-wrap;
      word-break: break-all;
      line-height: 1.5;
    }
    .output-code.prompt-view pre {
      color: var(--c-neon);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--c-neon);
      color: black;
      padding: 12px 20px;
      border-radius: 6px;
      font-family: 'Share Tech Mono', monospace;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--c-panel); }
    ::-webkit-scrollbar-thumb { background: var(--c-violet-dark); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--c-violet); }

    /* Responsive */
    @media (max-width: 1024px) {
      .generator-layout {
        grid-template-columns: 1fr;
      }
      .form-panel {
        border-right: none;
        border-bottom: 2px solid var(--c-neon);
      }
      .preview-frame-wrapper {
        min-height: 350px;
      }
    }

    @media (max-width: 640px) {
      .generator-header {
        padding: 15px;
      }
      .generator-header h1 {
        font-size: 0.9rem;
      }
      .form-panel, .preview-frame-container, .output-section {
        padding: 15px;
      }
      .buttons-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="generator-header">
    <h1>
      <i class="fas fa-wand-magic-sparkles"></i>
      G√âN√âRATEUR DE PROMPTS
      <i class="fas fa-gamepad"></i>
    </h1>
    <p>Cr√©ez des jeux HTML5 auto-contenus avec l'IA</p>
    <div class="subtitle">
      <i class="fas fa-code"></i>
      <span style="font-family: 'Share Tech Mono', monospace; font-size: 0.8rem; color: var(--c-violet-light);">HTML5 Auto-contenu ‚Ä¢ PC + Mobile</span>
      <i class="fas fa-rocket"></i>
    </div>
  </header>

  <!-- Layout -->
  <div class="generator-layout">

    <!-- Form Panel -->
    <div class="form-panel">
      <h2 class="section-title"><i class="fas fa-sliders"></i> Param√®tres du jeu</h2>

      <form id="gameForm">
        <!-- Game Type -->
        <div class="form-group">
          <label><i class="fas fa-gamepad"></i> Template de jeu</label>
          <select id="gameType">
            <option value="clicker">üç™ Cookie Clicker - Click rapide, upgrades</option>
            <option value="idleBusiness">üí∞ Idle Business - Gains passifs, buildings</option>
            <option value="tapTree">üå≥ Tap Tree - R√©colte fruits, croissance</option>
            <option value="match3">üß© Match-3 Puzzle - Aligner 3+ √©l√©ments</option>
            <option value="memory">üß† Memory Game - Retourner cartes</option>
            <option value="whackMole">üî® Whack-a-Mole - Frapper les cibles</option>
            <option value="targetPractice">üéØ Target Practice - Tir sur cibles</option>
            <option value="simonSays">üî¥ Simon Says - R√©p√©ter s√©quences</option>
            <option value="runner">ü¶ñ Runner Infini - Sauter obstacles</option>
            <option value="spaceShooter">üöÄ Space Shooter - Tirer sur ennemis</option>
            <option value="platformer">üéÆ Platformer - Sauter, plateformes</option>
            <option value="flappyBird">üê¶ Flappy Bird - √âviter obstacles</option>
            <option value="dodgeEnemies">üëæ Dodge Enemies - √âviter, survie</option>
            <option value="warCard">üÉè War Card - Bataille de cartes</option>
            <option value="slotMachine">üé∞ Slot Machine - Machine √† sous</option>
            <option value="diceRoller">üé≤ Dice Roller - Lancer de d√©s</option>
            <option value="colorMatch">üåà Color Match - Cliquer couleur</option>
            <option value="breakout">üß± Breakout - Casser briques</option>
            <option value="drawing">üé® Drawing Game - Dessiner formes</option>
            <option value="tetris">üß© Tetris-Like - Chute de blocs</option>
          </select>
        </div>

        <!-- Ambiance + Platform -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label><i class="fas fa-palette"></i> Ambiance</label>
            <select id="ambiance">
              <option value="cyberpunk">üåê Cyberpunk - N√©on, synth√©</option>
              <option value="kawaii">üå∏ Kawaii - Pastel, mignon</option>
              <option value="retro">üëæ R√©tro - Pixel art, 8-bit</option>
              <option value="dark">üåë Dark - Sombre, sinistre</option>
              <option value="nature">üåø Nature - Vert, serein</option>
              <option value="fantasy">‚öîÔ∏è Fantasy - √âpique, magique</option>
              <option value="scifi">üõ∏ Sci-Fi - Futuriste</option>
              <option value="minimalist">‚ö™ Minimaliste - √âpur√©</option>
              <option value="funky">üé∏ Funky - Groove, r√©tro</option>
              <option value="horror">üëª Horror - Tension, peur</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-display"></i> Plateforme</label>
            <select id="platform">
              <option value="responsive">üì±üíª Responsive</option>
              <option value="mobile">üì± Mobile-first</option>
              <option value="desktop">üíª Desktop</option>
            </select>
          </div>
        </div>

        <!-- Audio Options -->
        <div class="form-group">
          <label><i class="fas fa-volume-high"></i> Audio & Options</label>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" id="musicEnabled" checked>
              <span><i class="fas fa-music"></i> Musique g√©n√©rative</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="soundsEnabled" checked>
              <span><i class="fas fa-bell"></i> Effets sonores (SFX)</span>
            </label>
            <label class="checkbox-item troll-mode">
              <input type="checkbox" id="trollMode">
              <span>ü§° Mode Troll (Pi√®ge)</span>
            </label>
            <p class="troll-description">Rend le jeu frustrant : contr√¥les invers√©s, faux bugs, IA tricheuse...</p>
          </div>
        </div>

        <!-- Polish Level -->
        <div class="form-group">
          <label><i class="fas fa-sparkles"></i> Niveau de polish</label>
          <div class="range-container">
            <input type="range" id="polish" min="1" max="3" value="3">
            <div class="range-label">
              <span>Rapide</span>
              <span>Standard</span>
              <span>Pro</span>
            </div>
          </div>
        </div>

        <!-- Generate Button -->
        <button type="submit" class="btn-primary">
          <i class="fas fa-rocket"></i> G√©n√©rer Prompt + Jeu
        </button>

        <div class="buttons-row">
          <button type="button" id="saveToLocal" class="btn-secondary">
            <i class="fas fa-save"></i> Sauvegarder
          </button>
          <button type="button" id="resetAll" class="btn-secondary">
            <i class="fas fa-undo"></i> R√©initialiser
          </button>
        </div>
      </form>
    </div>

    <!-- Preview Panel -->
    <div class="preview-panel">
      <div class="preview-header">
        <h2><i class="fas fa-eye"></i> APER√áU JOUABLE</h2>
        <span id="previewMeta" class="preview-meta"></span>
      </div>

      <div class="preview-frame-container">
        <div class="preview-frame-wrapper">
          <div id="previewPlaceholder" class="preview-placeholder">
            <i class="fas fa-gamepad"></i>
            <p>G√©n√©rez un jeu pour l'afficher ici</p>
          </div>
          <iframe id="previewFrame" class="preview-frame hidden" sandbox="allow-scripts allow-pointer-lock allow-same-origin" allow="autoplay"></iframe>
          <div id="trollBadge" class="troll-badge hidden">ü§° TROLL EDITION</div>
        </div>

        <div class="preview-controls">
          <button id="playButton" class="btn-secondary" disabled>
            <i class="fas fa-play"></i> Jouer
          </button>
          <button id="stopButton" class="btn-secondary" disabled>
            <i class="fas fa-stop"></i> Arr√™ter
          </button>
        </div>
      </div>

      <!-- Output Section -->
      <div class="output-section">
        <div class="output-tabs">
          <button id="tabPrompt" class="output-tab active">üß© Prompt</button>
          <button id="tabCode" class="output-tab">üìÑ Code HTML</button>
        </div>

        <div class="output-actions">
          <button id="copyButton" class="btn-secondary" disabled>
            <i class="fas fa-copy"></i> Copier
          </button>
          <button id="downloadButton" class="btn-secondary" disabled>
            <i class="fas fa-download"></i> T√©l√©charger
          </button>
        </div>

        <div id="outputCode" class="output-code prompt-view">
          <pre id="output">G√©n√©rez un jeu pour afficher le prompt et le code ici...</pre>
        </div>
      </div>
    </div>

  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span>Copi√© dans le presse-papier !</span>
  </div>

  <script>
    // --- Data ---
    const gameTemplates = {
      clicker: { name: "Cookie Clicker", description: "Click rapide, upgrades exponentiels" },
      idleBusiness: { name: "Idle Business", description: "Gains passifs, employ√©s, buildings" },
      tapTree: { name: "Tap Tree", description: "R√©colte fruits, croissance progressive" },
      match3: { name: "Match-3 Puzzle", description: "Aligner 3+ √©l√©ments, combos" },
      memory: { name: "Memory Game", description: "Retourner cartes identiques" },
      whackMole: { name: "Whack-a-Mole", description: "Frapper cibles qui apparaissent" },
      targetPractice: { name: "Target Practice", description: "Tirer/pointer sur cibles mobiles" },
      simonSays: { name: "Simon Says", description: "R√©p√©ter s√©quences croissantes" },
      runner: { name: "Runner Infini", description: "Sauter obstacles, score illimit√©" },
      spaceShooter: { name: "Space Shooter", description: "Tirer sur ennemis, vagues" },
      platformer: { name: "Platformer Simple", description: "Sauter, plateforme, boss" },
      flappyBird: { name: "Flappy Bird Clone", description: "√âviter obstacles par tap/click" },
      dodgeEnemies: { name: "Dodge Enemies", description: "√âviter ennemis mobiles, survie" },
      warCard: { name: "War Card Game", description: "Cartes al√©atoires, bataille rapide" },
      slotMachine: { name: "Slot Machine", description: "Roulette chance, multiplicateurs" },
      diceRoller: { name: "Dice Roller", description: "Lancer d√©s, lucky numbers, scoring" },
      colorMatch: { name: "Color Match", description: "Clicker sur couleur demand√©e" },
      breakout: { name: "Breakout", description: "Balle rebondissante, briques" },
      drawing: { name: "Drawing Game", description: "Dessiner formes, reconnaissance simple" },
      tetris: { name: "Tetris-Like", description: "Chutes de blocs, placement" }
    };

    const ambiances = {
      kawaii: { name: "Kawaii", colors: ["#FFB6C1", "#FF69B4", "#FF1493", "#FFE4E1"] },
      cyberpunk: { name: "Cyberpunk", colors: ["#000000", "#00FFFF", "#FF00FF", "#003939"] },
      retro: { name: "R√©tro", colors: ["#2D5016", "#22C55E", "#F59E0B", "#1F2937"] },
      dark: { name: "Dark", colors: ["#0F172A", "#1E293B", "#64748B", "#EF4444"] },
      nature: { name: "Nature", colors: ["#14532D", "#22C55E", "#A3E635", "#60A5FA"] },
      fantasy: { name: "Fantasy", colors: ["#4C1D95", "#A855F7", "#F472B6", "#F59E0B"] },
      scifi: { name: "Sci-Fi", colors: ["#0C1929", "#0EA5E9", "#22D3EE", "#60A5FA"] },
      minimalist: { name: "Minimaliste", colors: ["#FFFFFF", "#F3F4F6", "#9CA3AF", "#111827"] },
      funky: { name: "Funky", colors: ["#7C2D12", "#FB7185", "#FBBF24", "#22C55E"] },
      horror: { name: "Horror", colors: ["#0A0A0A", "#7F1D1D", "#EF4444", "#4B5563"] }
    };

    // --- DOM Elements ---
    const gameForm = document.getElementById('gameForm');
    const gameTypeSelect = document.getElementById('gameType');
    const ambianceSelect = document.getElementById('ambiance');
    const platformSelect = document.getElementById('platform');
    const polishRange = document.getElementById('polish');
    const musicCheck = document.getElementById('musicEnabled');
    const soundCheck = document.getElementById('soundsEnabled');
    const trollCheck = document.getElementById('trollMode');
    const playButton = document.getElementById('playButton');
    const stopButton = document.getElementById('stopButton');
    const copyButton = document.getElementById('copyButton');
    const downloadButton = document.getElementById('downloadButton');
    const tabPrompt = document.getElementById('tabPrompt');
    const tabCode = document.getElementById('tabCode');
    const output = document.getElementById('output');
    const outputCode = document.getElementById('outputCode');
    const previewFrame = document.getElementById('previewFrame');
    const previewPlaceholder = document.getElementById('previewPlaceholder');
    const previewMeta = document.getElementById('previewMeta');
    const trollBadge = document.getElementById('trollBadge');
    const toast = document.getElementById('toast');

    // --- State ---
    let currentPrompt = '';
    let currentGameCode = '';
    let activeTab = 'prompt';

    // --- Utilities ---
    function getGameEmoji(gameType) {
      const emojis = {
        clicker:'üç™', idleBusiness:'üí∞', tapTree:'üå≥', match3:'üß©', memory:'üß†',
        whackMole:'üî®', targetPractice:'üéØ', simonSays:'üî¥', runner:'ü¶ñ',
        spaceShooter:'üöÄ', platformer:'üéÆ', flappyBird:'üê¶', dodgeEnemies:'üëæ',
        warCard:'üÉè', slotMachine:'üé∞', diceRoller:'üé≤', colorMatch:'üåà',
        breakout:'üß±', drawing:'üé®', tetris:'üß©'
      };
      return emojis[gameType] || 'üéÆ';
    }

    function showToast(message) {
      toast.querySelector('span').textContent = message || 'Copi√© dans le presse-papier !';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function setActiveTab(next) {
      activeTab = next;
      tabPrompt.classList.toggle('active', next === 'prompt');
      tabCode.classList.toggle('active', next === 'code');
      outputCode.classList.toggle('prompt-view', next === 'prompt');
      renderOutput();
    }

    function renderOutput() {
      if (!currentPrompt && !currentGameCode) {
        output.textContent = 'G√©n√©rez un jeu pour afficher le prompt et le code ici...';
        return;
      }
      output.textContent = activeTab === 'prompt' ? currentPrompt : currentGameCode;
    }

    // --- Prompt Generator ---
    function buildPrompt({ gameType, ambianceKey, platform, musicEnabled, soundsEnabled, polish, trollMode }) {
      const game = gameTemplates[gameType];
      const amb = ambiances[ambianceKey];

      const platformReq = platform === 'mobile'
        ? "Mobile-first : UI touch-friendly + gros boutons + gestes (tap/swipe si pertinent)."
        : platform === 'desktop'
          ? "Desktop : clavier + souris, raccourcis (Espace/Fl√®ches), feedback visuel."
          : "Responsive PC + Mobile : touch + clavier/souris, layout adaptatif, canvas retina.";

      const audioReq = `Audio:
- Musique g√©n√©rative: ${musicEnabled ? 'ON' : 'OFF'}
- Effets sonores: ${soundsEnabled ? 'ON' : 'OFF'}
- Utiliser Tone.js + Web Audio API. D√©marrer l'audio uniquement apr√®s une interaction utilisateur.`;

      const polishReq = polish >= 3
        ? "Polish PRO: HUD moderne, micro-animations, particules, glow, transitions, feedback haptique (vibration si mobile), save best score."
        : polish >= 2
          ? "Polish STANDARD: UI propre, animations basiques, score visible."
          : "Polish RAPIDE: Fonctionnel, minimaliste.";

      const trollReq = trollMode 
        ? `
üòà MODE TROLL ACTIV√â (CRITIQUE): Le jeu doit √™tre intentionnellement frustrant et dr√¥le. Exemples obligatoires :
- Contr√¥les invers√©s al√©atoirement ou glissants.
- Hitboxes l√©g√®rement d√©cal√©es.
- Messages moqueurs quand on perd (ex: 'Tu as essay√© ?', 'C'est tout ?').
- Faux bugs visuels (glitch screen, texte qui tremble).
- Sons ridicules ou dissonants.
- L'IA triche subtilement.
- Fais en sorte que le joueur puisse gagner, mais difficilement.`
        : "Gameplay : Juste, √©quilibr√© et satisfaisant.";

      return `Tu es un expert en d√©veloppement de jeux HTML5. G√©n√®re un fichier unique et auto-contenu (un seul .html) qui impl√©mente un jeu complet.

CONTRAINTES TECHNIQUES:
- Un seul fichier HTML (pas d'assets externes sauf librairies CDN connues comme Tone.js).
- Gameplay via Canvas 2D + UI HTML/CSS moderne.
- ${platformReq}
- Canvas responsive + devicePixelRatio.
- √âcran: Menu ‚Üí Jeu ‚Üí Game Over, bouton Rejouer.

JEU √Ä CR√âER:
- Template: ${getGameEmoji(gameType)} ${game.name}
- Description: ${game.description}
- Ambiance: ${amb.name} (palette: ${amb.colors.join(', ')})
${trollReq}

${audioReq}

NIVEAU DE POLISH:
- ${polishReq}

SORTIE ATTENDUE:
- Retourne UNIQUEMENT le contenu du fichier .html, sans explications.`;
    }

    // --- Code Generator (Demo) ---
    function generateGameCode({ gameType, ambianceKey, platform, trollMode }) {
      const game = gameTemplates[gameType];
      const amb = ambiances[ambianceKey];
      const titleSuffix = trollMode ? " (Troll Edition ü§°)" : "";
      const title = game.name + ' ‚Äî ' + amb.name + titleSuffix;
      const colors = amb.colors;

      return `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>${title}</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      overflow: hidden;
      background: linear-gradient(135deg, ${colors[0]}, ${colors[3] || colors[1]});
      color: ${colors[2] || '#ffffff'};
      font-family: 'Rajdhani', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      text-shadow: 0 0 20px ${colors[1]};
      margin-bottom: 20px;
      text-align: center;
      padding: 0 10px;
    }
    canvas {
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      border: 2px solid ${colors[1]};
      box-shadow: 0 0 30px ${colors[1]}40;
      max-width: 95%;
    }
    .btn {
      margin-top: 20px;
      padding: 12px 30px;
      background: ${colors[1]};
      color: ${colors[0]};
      border: none;
      border-radius: 8px;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
    }
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px ${colors[1]};
    }
    .info {
      margin-top: 15px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <h1>${title}</h1>
  <canvas id="gameCanvas"></canvas>
  <button class="btn" onclick="startGame()">‚ñ∂ START GAME</button>
  <p class="info">Ceci est une d√©mo visuelle g√©n√©r√©e</p>
  
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    function resize() {
      canvas.width = Math.min(window.innerWidth - 40, 600);
      canvas.height = canvas.width * 0.6;
    }
    resize();
    window.addEventListener('resize', resize);
    
    let t = 0;
    let particles = [];
    
    // Cr√©er des particules
    for(let i = 0; i < 20; i++) {
      particles.push({
        x: Math.random() * 600,
        y: Math.random() * 360,
        vx: (Math.random() - 0.5) * 2,
        vy: (Math.random() - 0.5) * 2,
        size: Math.random() * 8 + 4
      });
    }
    
    function loop() {
      ctx.fillStyle = 'rgba(0,0,0,0.15)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Dessiner les particules
      particles.forEach(p => {
        ${trollMode ? `
        // Mode Troll : mouvement erratique
        p.x += p.vx + Math.sin(t * 5) * 3;
        p.y += p.vy + Math.cos(t * 3) * 3;
        ` : `
        p.x += p.vx;
        p.y += p.vy;
        `}
        
        if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
        if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
        
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = '${colors[1]}';
        ctx.fill();
        
        // Glow effect
        ctx.shadowColor = '${colors[1]}';
        ctx.shadowBlur = 15;
      });
      
      // √âl√©ment central
      ctx.beginPath();
      const cx = canvas.width / 2 + Math.sin(t) * ${trollMode ? 80 : 30};
      const cy = canvas.height / 2 + Math.cos(t ${trollMode ? '* 2' : ''}) * ${trollMode ? 50 : 20};
      ctx.arc(cx, cy, 25, 0, Math.PI * 2);
      ctx.fillStyle = '${colors[2] || colors[1]}';
      ctx.fill();
      ctx.shadowBlur = 25;
      
      t += 0.03;
      requestAnimationFrame(loop);
    }
    loop();
    
    function startGame() {
      alert('${trollMode ? "ü§° Ha ha ! Tu pensais vraiment jouer ? (Ceci est une d√©mo visuelle)" : "üéÆ Jeu d√©mo g√©n√©r√© ! Utilisez le prompt avec un LLM pour obtenir le vrai jeu."}');
    }
  <\/script>
</body>
</html>`;
    }

    // --- Event Listeners ---
    gameForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const config = {
        gameType: gameTypeSelect.value,
        ambianceKey: ambianceSelect.value,
        platform: platformSelect.value,
        musicEnabled: musicCheck.checked,
        soundsEnabled: soundCheck.checked,
        polish: parseInt(polishRange.value),
        trollMode: trollCheck.checked
      };

      currentPrompt = buildPrompt(config);
      currentGameCode = generateGameCode(config);

      setActiveTab('prompt');
      previewMeta.textContent = `${gameTemplates[config.gameType].name} ‚Ä¢ ${ambiances[config.ambianceKey].name}`;
      
      playButton.disabled = false;
      copyButton.disabled = false;
      downloadButton.disabled = false;
      
      if(config.trollMode) {
        trollBadge.classList.remove('hidden');
      } else {
        trollBadge.classList.add('hidden');
      }

      showToast('Prompt et code g√©n√©r√©s !');
    });

    tabPrompt.addEventListener('click', () => setActiveTab('prompt'));
    tabCode.addEventListener('click', () => setActiveTab('code'));

    playButton.addEventListener('click', () => {
      previewPlaceholder.classList.add('hidden');
      previewFrame.classList.remove('hidden');
      
      const doc = previewFrame.contentWindow.document;
      doc.open();
      doc.write(currentGameCode);
      doc.close();

      playButton.disabled = true;
      stopButton.disabled = false;
    });

    stopButton.addEventListener('click', () => {
      previewPlaceholder.classList.remove('hidden');
      previewFrame.classList.add('hidden');
      previewFrame.src = 'about:blank';
      
      playButton.disabled = false;
      stopButton.disabled = true;
    });

    copyButton.addEventListener('click', () => {
      const txt = activeTab === 'prompt' ? currentPrompt : currentGameCode;
      
      // Fallback copy method
      const textArea = document.createElement("textarea");
      textArea.value = txt;
      textArea.style.position = "fixed";
      textArea.style.left = "-9999px";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        showToast(activeTab === 'prompt' ? 'Prompt copi√© !' : 'Code HTML copi√© !');
      } catch (err) {
        console.error('Copy failed', err);
        showToast('Erreur lors de la copie');
      }
      
      document.body.removeChild(textArea);
    });

    downloadButton.addEventListener('click', () => {
      const blob = new Blob([currentGameCode], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const name = `${gameTypeSelect.value}_${ambianceSelect.value}${trollCheck.checked ? '_troll' : ''}.html`;
      a.download = name;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Fichier t√©l√©charg√© !');
    });

    document.getElementById('resetAll').addEventListener('click', () => {
      gameForm.reset();
      currentPrompt = '';
      currentGameCode = '';
      renderOutput();
      previewPlaceholder.classList.remove('hidden');
      previewFrame.classList.add('hidden');
      trollBadge.classList.add('hidden');
      playButton.disabled = true;
      stopButton.disabled = true;
      copyButton.disabled = true;
      downloadButton.disabled = true;
      previewMeta.textContent = '';
    });

    document.getElementById('saveToLocal').addEventListener('click', () => {
      const config = {
        gameType: gameTypeSelect.value,
        ambiance: ambianceSelect.value,
        platform: platformSelect.value,
        music: musicCheck.checked,
        sounds: soundCheck.checked,
        polish: polishRange.value,
        troll: trollCheck.checked
      };
      localStorage.setItem('cortech_prompt_config', JSON.stringify(config));
      showToast('Configuration sauvegard√©e !');
    });

    // Load saved config on startup
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('cortech_prompt_config');
      if (saved) {
        try {
          const config = JSON.parse(saved);
          gameTypeSelect.value = config.gameType || 'clicker';
          ambianceSelect.value = config.ambiance || 'cyberpunk';
          platformSelect.value = config.platform || 'responsive';
          musicCheck.checked = config.music !== false;
          soundCheck.checked = config.sounds !== false;
          polishRange.value = config.polish || 3;
          trollCheck.checked = config.troll || false;
        } catch(e) {
          console.log('Could not load saved config');
        }
      }
    });
  </script>

</body>
</html>
